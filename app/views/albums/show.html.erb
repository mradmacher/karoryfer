<%= render_title @album.title %>
<h1><%= current_artist.name %></h1>
<h2><%= t 'helpers.title.album.index' %>
	<% unless @album.published? %>
		<span class="status">(<%= t('helpers.label.album.unpublished') %>)</span>
	<% end %>
</h2>

<% content_for :actions do %>
  <% if can? :manage, @album %>
    <%= link_to_action t( "helpers.action.album.edit" ), edit_artist_album_path( @album.artist, @album ) %>
  <% end %>
<% end %>

<div class="media">
	<%= link_to image_tag( @album.image.url( :normal ), :alt => @album.title, :class => 'media-object' ), @album.image.url( :original ),
    :class => 'pull-left' %>
  <div class="media-body">
    <h3 class="media-heading"><%= @album.title %></h3>
    <h4><%= @album.year.to_s %></h4>

    <p>
    <% if @album.license.present? %>
      <%= render :partial => 'licenses/cc', 
        :locals => { :author => @album.artist, :license => @album.license } %>
    <% end %>
    </p>
  </div>
</div>
<br />
<% unless @album.releases.empty? %>
  <ul class="unstyled inline">
  <% Release::FORMATS.each do |format| %>
    <% if release = @album.releases.in_format( format ).first %>
      <li>
        <a href="<%= release.file.url %>" title="<%= t('helpers.label.download') %> <%= format %>">
          <button class="download-button img-circle"><strong><%= format %></strong></button></a>
      </li>
    <% end %>
  <% end %>
  </ul>
<% end %>

<% unless @album.donation.blank? %>
  <div class="well donations">
    <%=raw @album.donation %>
    <% if Setting.get( 'donations_info_url' ) %>
      <div><small><i><%= link_to 'Informacja na temat darowizn', Setting.get( 'donations_info_url' ) %></i></small></div>
    <% end %>
  </div>
<% end %>

<%= render_textile @album.description %>

<% unless @album.tracks.empty? %>
  <h5><%= t 'helpers.title.track.index' %></h5>
  <ol id="tracklist">
    <% @album.tracks.each do |track| %>
      <li data-track-id="<%= track.id %>">
      <span class="title"><%= track.title %> <% unless track.comment.blank? -%><br /><small><%= track.comment %></small> <% end -%></span>
      <% track.releases.each do |release| %>
        <span data-url="<%= release.file.url %>" data-format="<%= release.format %>" />
      <% end %>
      </li>
    <% end %>
  </ol>

  <div id="jquery_jplayer_1" class="jp-jplayer"></div>
  <div id="jp_container_1" class="jp-audio">
    <div class="jp-type-playlist">
      <div class="jp-gui jp-interface">
        <ul class="jp-controls">
        </ul>
        <div class="jp-progress">
          <div class="jp-seek-bar">
            <div class="jp-play-bar"></div>
          </div>
        </div>
        <div class="jp-volume-bar">
          <div class="jp-volume-bar-value"></div>
        </div>
        <div class="jp-time-holder">
          <div class="jp-current-time"></div>
          <div class="jp-duration"></div>
        </div>
        <ul class="jp-toggles">
        </ul>
      </div>
      <div class="jp-playlist">
        <ul>
        </ul>
      </div>
      <div class="jp-no-solution">
        <span>Update Required</span>
        To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.
      </div>
    </div>
  </div>
<% end %>
<br />
<div class="well">
  <%= render partial: 'embeds/facebook', locals: { url: album_url( @album ) } %>
  <br />
  <%= render partial: 'embeds/twitter' %>
</div>

<script type="text/javascript">
//<![CDATA[
$(document).ready(function(){
  $( '.jp-controls' ).append( '<li><a href="#" class="jp-previous" tabindex="1">previous</a></li>' );
  $( '.jp-controls' ).append( '<li><a href="#" class="jp-play" tabindex="1">play</a></li>' );
  $( '.jp-controls' ).append( '<li><a href="#" class="jp-pause" tabindex="1">pause</a></li>' );
  $( '.jp-controls' ).append( '<li><a href="#" class="jp-next" tabindex="1">next</a></li>' );
  $( '.jp-controls' ).append( '<li><a href="#" class="jp-stop" tabindex="1">stop</a></li>' );
  $( '.jp-controls' ).append( '<li><a href="#" class="jp-mute" tabindex="1">mute</a></li>' );
  $( '.jp-controls' ).append( '<li><a href="#" class="jp-unmute" tabindex="1">unmute</a></li>' );
  $( '.jp-controls' ).append( '<li><a href="#" class="jp-volume-max" tabindex="1">max volume</a></li>' );

  $( '.jp-toggles' ).append( '<li><a href="#" class="jp-shuffle" tabindex="1" title="shuffle">shuffle</a></li>' );
  $( '.jp-toggles' ).append( '<li><a href="#" class="jp-shuffle-off" tabindex="1" title="shuffle off">shuffle off</a></li>' );
  $( '.jp-toggles' ).append( '<li><a href="#" class="jp-repeat" tabindex="1" title="repeat">repeat</a></li>' );
  $( '.jp-toggles' ).append( '<li><a href="#" class="jp-repeat-off" tabindex="1" title="repeat off">repeat off</a></li>' );

	var playlist = new jPlayerPlaylist({
		jPlayer: "#jquery_jplayer_1",
		cssSelectorAncestor: "#jp_container_1"
	}, [
	], {
		swfPath: '/js',
		supplied: 'oga, mp3'
	});

  $( '#tracklist > li' ).each( function(index){
    playlist.add( {
      title: $(this).find( '.title' ).html(),
      oga: $(this).find( '[data-format=ogg]' ).attr( 'data-url' ),
      mp3: $(this).find( '[data-format=mp3]' ).attr( 'data-url' )
    });
  });

  $( '#tracklist' ).remove();
});
//]]>
</script>

